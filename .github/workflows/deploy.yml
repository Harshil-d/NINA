name: Deployment Workflow

on: 
  push:
    branches: [ develop ]

env:
  PROJECT_ROOT: '/var/www/NINA'
  TEST_CONFIG: '/var/.deploy_configs/NINA/test'
    
jobs:
  job_one:
    name: testing
    runs-on: ubuntu-latest
    steps:
    - name: testing server ssh connection
      uses: appleboy/ssh-action@master
      with:
        host: 13.235.184.34
        username: deploy
        password: YMTV2S6argbp
        port: 22
        script_stop: true
        envs: TEST_CONFIG,PROJECT_ROOT
        script: |
          source ~/.profile
          cd $PROJECT_ROOT
          pwd
          git pull origin develop
          git status
          cp $TEST_CONFIG/. ./  
          npm install
          npm run build
          npm run start:test
          echo "Basic setup tested successfully" && sleep 2
          
